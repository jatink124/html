<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Leverage P&L Calculator</title>
    <!-- Tailwind Play CDN (small, for demo) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  </head>
  <body class="bg-slate-50 min-h-screen flex items-center justify-center p-6">
    <div id="root" class="w-full max-w-3xl"></div>

    <script type="text/javascript">
      const { useState, useMemo } = React;

      function App() {
        // Defaults chosen to match your example
        const [tradeType, setTradeType] = useState('short');
        const [entry, setEntry] = useState(106546);
        const [exitPrice, setExitPrice] = useState(106183);
        const [lots, setLots] = useState(7);         // e.g., 7 lots
        const [lotSize, setLotSize] = useState(0.001); // 7 * 0.001 = 0.007 BTC
        const [leverage, setLeverage] = useState(150);
        const [feePercent, setFeePercent] = useState(0.05); // per-side taker fee in %
        const [usdToInr, setUsdToInr] = useState(84.2);

        // Derived values
        const quantity = useMemo(() => {
          const q = Number(lots) * Number(lotSize);
          return Number.isFinite(q) ? q : 0;
        }, [lots, lotSize]);

        const grossPnl = useMemo(() => {
          const q = quantity;
          // For long: buy entry then sell at exit => pnl = (exit - entry)*q
          // For short: sell at entry then buy at exit => pnl = (entry - exit)*q
          let pnl = 0;
          if (tradeType === 'long') pnl = (Number(exitPrice) - Number(entry)) * q;
          else pnl = (Number(entry) - Number(exitPrice)) * q;
          return pnl;
        }, [tradeType, entry, exitPrice, quantity]);

        const positionSize = useMemo(() => Number(entry) * quantity, [entry, quantity]);
        const margin = useMemo(() => positionSize / Math.max(1, Number(leverage)), [positionSize, leverage]);

        // fees applied to both sides (entry + exit)
        const fees = useMemo(() => {
          // feePercent is in percent (e.g., 0.05 => 0.05%)
          const pct = Number(feePercent) / 100;
          // fees = (entry price * qty * pct) + (exit price * qty * pct)
          return ((Number(entry) + Number(exitPrice)) * quantity) * pct;
        }, [entry, exitPrice, quantity, feePercent]);

        const netPnl = useMemo(() => grossPnl - fees, [grossPnl, fees]);

        // ROI on margin (if margin=0 then Infinity/NaN handled)
        const roiPercent = useMemo(() => {
          if (margin === 0) return 0;
          return (netPnl / margin) * 100;
        }, [netPnl, margin]);

        return (
          React.createElement('div', { className: "bg-white shadow-md rounded-lg p-6" },
            React.createElement('h1', { className: "text-2xl font-semibold mb-4" }, "Leverage P&L Calculator"),
            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
              // Left column: inputs
              React.createElement('div', { className: "space-y-3" },
                React.createElement('label', { className: "block" },
                  React.createElement('span', { className: "text-sm text-slate-600" }, "Trade type"),
                  React.createElement('select', {
                    value: tradeType, onChange: e => setTradeType(e.target.value),
                    className: "mt-1 block w-full rounded border px-2 py-2"
                  },
                    React.createElement('option', { value: "long" }, "Long (buy then sell)"),
                    React.createElement('option', { value: "short" }, "Short (sell then buy)")
                  )
                ),

                React.createElement('div', { className: "flex gap-2" },
                  React.createElement('label', { className: "flex-1" },
                    React.createElement('span', { className: "text-sm text-slate-600" }, "Entry price (USD)"),
                    React.createElement('input', {
                      type: "number", value: entry, onChange: e => setEntry(e.target.value),
                      className: "mt-1 block w-full rounded border px-2 py-2"
                    })
                  ),
                  React.createElement('label', { className: "flex-1" },
                    React.createElement('span', { className: "text-sm text-slate-600" }, "Exit price (USD)"),
                    React.createElement('input', {
                      type: "number", value: exitPrice, onChange: e => setExitPrice(e.target.value),
                      className: "mt-1 block w-full rounded border px-2 py-2"
                    })
                  )
                ),

                React.createElement('div', { className: "flex gap-2" },
                  React.createElement('label', { className: "flex-1" },
                    React.createElement('span', { className: "text-sm text-slate-600" }, "Lots"),
                    React.createElement('input', {
                      type: "number", step: "any", value: lots, onChange: e => setLots(e.target.value),
                      className: "mt-1 block w-full rounded border px-2 py-2"
                    })
                  ),
                  React.createElement('label', { className: "flex-1" },
                    React.createElement('span', { className: "text-sm text-slate-600" }, "Lot size (BTC per lot)"),
                    React.createElement('input', {
                      type: "number", step: "any", value: lotSize, onChange: e => setLotSize(e.target.value),
                      className: "mt-1 block w-full rounded border px-2 py-2"
                    })
                  )
                ),

                React.createElement('div', { className: "flex gap-2" },
                  React.createElement('label', { className: "flex-1" },
                    React.createElement('span', { className: "text-sm text-slate-600" }, "Leverage (x)"),
                    React.createElement('input', {
                      type: "number", value: leverage, onChange: e => setLeverage(e.target.value),
                      className: "mt-1 block w-full rounded border px-2 py-2"
                    })
                  ),
                  React.createElement('label', { className: "flex-1" },
                    React.createElement('span', { className: "text-sm text-slate-600" }, "Fee per side (%)"),
                    React.createElement('input', {
                      type: "number", step: "any", value: feePercent, onChange: e => setFeePercent(e.target.value),
                      className: "mt-1 block w-full rounded border px-2 py-2"
                    })
                  )
                ),

                React.createElement('label', { className: "" },
                  React.createElement('span', { className: "text-sm text-slate-600" }, "USD → INR rate (optional)"),
                  React.createElement('input', {
                    type: "number", step: "any", value: usdToInr, onChange: e => setUsdToInr(e.target.value),
                    className: "mt-1 block w-full rounded border px-2 py-2"
                  })
                ),

                React.createElement('div', { className: "text-sm text-slate-500 mt-2" },
                  React.createElement('p', null, "Quantity (BTC) = lots × lot size"),
                  React.createElement('p', null, `Quantity = ${lots} × ${lotSize} = ${quantity.toFixed(6)} BTC`)
                )
              ),

              // Right column: results
              React.createElement('div', { className: "space-y-3 bg-slate-50 p-4 rounded" },
                StatRow("Gross P&L (USD)", grossPnl),
                StatRow("Position size (USD)", positionSize),
                StatRow("Margin required (USD)", margin),
                StatRow("Total fees (USD)", fees),
                StatRow("Net P&L (USD)", netPnl),
                StatRow("ROI on margin (%)", roiPercent),
                React.createElement('hr', { className: "my-2" }),
                StatRow("Gross P&L (INR)", grossPnl * Number(usdToInr)),
                StatRow("Net P&L (INR)", netPnl * Number(usdToInr))
              )
            ),

            React.createElement('div', { className: "mt-4 text-sm text-slate-600" },
              "Notes: Fees are applied to both entry & exit at the percentage you enter. ROI is calculated vs margin used."
            )
          )
        );
      }

      function StatRow(label, value) {
        const formatted = Number.isFinite(value) ? (Math.abs(value) >= 0.01 ? value.toFixed(4) : value.toFixed(8)) : "0";
        const sign = value > 0 ? "+" : value < 0 ? "−" : "";
        return React.createElement('div', { className: "flex justify-between items-center" },
          React.createElement('div', { className: "text-sm text-slate-700" }, label),
          React.createElement('div', { className: "font-medium text-slate-900" }, `${sign}${formatted}`)
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
  </body>
</html>
